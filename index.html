<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Recepção - Multi-usuário</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #2d8650 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #1e8449, #27ae60);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .status-connection {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .status-online {
            background: #d4edda;
            color: #155724;
        }
        
        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e1e8ed;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }
        
        .tab.active {
            background: white;
            color: #1e8449;
            border-bottom: 3px solid #27ae60;
        }
        
        .tab:hover {
            background: #e9ecef;
            color: #1e8449;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #27ae60;
        }
        
        .form-section h2 {
            color: #1e8449;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e8449;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #27ae60, #1e8449);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-small {
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        .btn-info {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .records-section {
            background: white;
        }
        
        .records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .records-header h2 {
            color: #1e8449;
            font-size: 1.8rem;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-card.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        .stat-card.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .stat-card.info {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            opacity: 0.9;
        }
        
        .filters {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
            max-height: 500px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #1e8449;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-aguardando {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-ematendimento {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-concluido {
            background: #d4edda;
            color: #155724;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #27ae60;
        }
        
        .dashboard-card h3 {
            color: #1e8449;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #27ae60;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .config-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #f39c12;
        }
        
        .config-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .config-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .config-input input {
            flex: 1;
        }
        
        .chart-container {
            width: 100%;
            height: 300px;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .chart-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #666;
            font-size: 1.2rem;
            text-align: center;
            padding: 20px;
        }
        
        .chart-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #27ae60;
        }
        
        .chart-placeholder p {
            margin-top: 10px;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #27ae60;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filters {
                grid-template-columns: 1fr;
            }
            
            .records-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">Registro adicionado com sucesso!</div>
    
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-building"></i> Sistema de Controle de Recepção</h1>
            <p>Gerencie visitantes presenciais de forma eficiente - Multi-usuário</p>
            <div id="connectionStatus" class="status-connection status-offline"><i class="fas fa-circle"></i> Desconectado</div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="sistema.trocarTab('visitantes')"><i class="fas fa-users"></i> Visitantes Presenciais</button>
            <button class="tab" onclick="sistema.trocarTab('dashboard')"><i class="fas fa-chart-bar"></i> Dashboard Geral</button>
            <button class="tab" onclick="sistema.trocarTab('config')"><i class="fas fa-cog"></i> Configurações</button>
        </div>
        
        <!-- TAB CONFIGURAÇÕES -->
        <div id="tab-config" class="tab-content">
            <div class="config-section">
                <h3><i class="fas fa-link"></i> Configuração Google Sheets</h3>
                <p style="margin-bottom: 15px;">Cole aqui a URL do Google Apps Script para sincronizar com sua planilha:</p>
                <div class="config-input">
                    <input type="url" id="sheetsURL" placeholder="https://script.google.com/macros/s/[SEU_ID]/exec">
                    <button class="btn btn-small" onclick="sistema.salvarConfig()"><i class="fas fa-save"></i> Salvar</button>
                    <button class="btn btn-small btn-info" onclick="sistema.testarConexao()"><i class="fas fa-plug"></i> Testar</button>
                </div>
                <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                    <i class="fas fa-info-circle"></i> Para configurar, crie um script no Google Apps Script com a função doGet e doPost para manipular os dados.
                </p>
            </div>
            <div class="config-section">
                <h3><i class="fas fa-database"></i> Migração de Dados</h3>
                <p style="margin-bottom: 15px;">Se você tem dados locais antigos, pode migrar para a planilha:</p>
                <button class="btn btn-warning" onclick="sistema.migrarDadosLocais()"><i class="fas fa-exchange-alt"></i> Migrar Dados Locais</button>
            </div>
            
            <div class="config-section">
                <h3><i class="fas fa-history"></i> Última Sincronização</h3>
                <div id="syncStatus">
                    <p><i class="fas fa-sync"></i> Última sincronização: <span id="lastSync">Nunca</span></p>
                    <p style="margin-top: 10px;"><i class="fas fa-database"></i> Total de registros: <span id="totalRecords">0</span></p>
                </div>
                <button class="btn btn-small" onclick="sistema.sincronizarDados()" style="margin-top: 15px;">
                    <i class="fas fa-sync-alt"></i> Sincronizar Agora
                </button>
            </div>
        </div>
        
        <!-- TAB VISITANTES -->
        <div id="tab-visitantes" class="tab-content active">
            <div class="main-content">
                <div class="form-section">
                    <h2><i class="fas fa-edit"></i> Registrar Nova Visita</h2>
                    <form id="visitForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nomeVisitante"><i class="fas fa-user"></i> Nome do Visitante *</label>
                                <input type="text" id="nomeVisitante" required>
                            </div>
                            <div class="form-group">
                                <label for="empresaOrigem"><i class="fas fa-building"></i> Empresa/Origem</label>
                                <input type="text" id="empresaOrigem">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tipoVisitante"><i class="fas fa-tag"></i> Tipo de Visitante *</label>
                                <select id="tipoVisitante" required>
                                    <option value="">Selecione...</option>
                                    <option value="Cliente">Cliente</option>
                                    <option value="Parceiro">Parceiro</option>
                                    <option value="Fornecedor">Fornecedor</option>
                                    <option value="Corretor">Corretor</option>
                                    <option value="Prestador de Serviço">Prestador de Serviço</option>
                                    <option value="Candidato">Candidato</option>
                                    <option value="Visitante Institucional">Visitante Institucional</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="telefone"><i class="fas fa-phone"></i> Telefone</label>
                                <input type="tel" id="telefone" placeholder="(11) 99999-9999">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="areaProcurada"><i class="fas fa-search"></i> Área Procurada *</label>
                            <select id="areaProcurada" required>
                                <option value="">Selecione...</option>
                                <option value="Administração">Administração</option>
                                <option value="Vendas/Comercial">Vendas/Comercial</option>
                                <option value="Suprimentos">Suprimentos</option>
                                <option value="Financeiro">Financeiro</option>
                                <option value="Gente e Gestão">Gente e Gestão</option>
                                <option value="TI/Tecnologia">TI/Tecnologia</option>
                                <option value="Produção">Produção</option>
                                <option value="Engenharia">Engenharia</option>
                                <option value="Diretoria">Diretoria</option>
                                <option value="Incorporação">Incorporação</option>
                                <option value="Produtos">Produtos</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Jurídico">Jurídico</option>
                                <option value="Relacionamento com o Cliente">Relacionamento com o Cliente</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="responsavel"><i class="fas fa-user-tie"></i> Responsável/Contato *</label>
                            <input type="text" id="responsavel" required placeholder="Nome da pessoa que vai receber">
                        </div>
                        
                        <div class="form-group">
                            <label for="motivoVisita"><i class="fas fa-comment"></i> Motivo da Visita</label>
                            <textarea id="motivoVisita" rows="3" placeholder="Breve descrição do objetivo da visita"></textarea>
                        </div>
                        
                        <button type="submit" class="btn" id="submitBtn"><i class="fas fa-check"></i> Registrar Entrada</button>
                    </form>
                </div>
                
                <div class="records-section">
                    <div class="records-header">
                        <h2><i class="fas fa-table"></i> Controle de Visitantes</h2>
                        <div class="export-buttons">
                            <button class="btn btn-small" onclick="sistema.atualizarVisitas()"><i class="fas fa-sync"></i> Atualizar</button>
                            <button class="btn btn-small" onclick="sistema.exportarExcel()"><i class="fas fa-file-excel"></i> Excel</button>
                            <button class="btn btn-small" onclick="sistema.exportarPDF()"><i class="fas fa-file-pdf"></i> PDF</button>
                        </div>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-card">
                            <h3 id="totalHoje">0</h3>
                            <p>Hoje</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="aguardando">0</h3>
                            <p>Aguardando</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="emAtendimento">0</h3>
                            <p>Em Atendimento</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="concluidos">0</h3>
                            <p>Concluídos</p>
                        </div>
                    </div>
                    
                    <div class="filters">
                        <select id="filtroTipo" onchange="sistema.filtrarVisitas()">
                            <option value="">Todos os tipos</option>
                            <option value="Cliente">Cliente</option>
                            <option value="Parceiro">Parceiro</option>
                            <option value="Fornecedor">Fornecedor</option>
                            <option value="Corretor">Corretor</option>
                            <option value="Prestador de Serviço">Prestador de Serviço</option>
                            <option value="Candidato">Candidato</option>
                            <option value="Visitante Institucional">Visitante Institucional</option>
                            <option value="Outros">Outros</option>
                        </select>
                        <select id="filtroArea" onchange="sistema.filtrarVisitas()">
                            <option value="">Todas as áreas</option>
                            <option value="Administração">Administração</option>
                            <option value="Vendas/Comercial">Vendas/Comercial</option>
                            <option value="Suprimentos">Suprimentos</option>
                            <option value="Financeiro">Financeiro</option>
                            <option value="Gente e Gestão">Gente e Gestão</option>
                            <option value="TI/Tecnologia">TI/Tecnologia</option>
                            <option value="Produção">Produção</option>
                            <option value="Engenharia">Engenharia</option>
                            <option value="Diretoria">Diretoria</option>
                            <option value="Incorporação">Incorporação</option>
                            <option value="Produtos">Produtos</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Jurídico">Jurídico</option>
                            <option value="Relacionamento com o Cliente">Relacionamento com o Cliente</option>
                            <option value="Outros">Outros</option>
                        </select>
                        <select id="filtroStatus" onchange="sistema.filtrarVisitas()">
                            <option value="">Todos os status</option>
                            <option value="Aguardando">Aguardando</option>
                            <option value="Em Atendimento">Em Atendimento</option>
                            <option value="Concluído">Concluído</option>
                        </select>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Entrada</th>
                                    <th>Visitante</th>
                                    <th>Tipo</th>
                                    <th>Área</th>
                                    <th>Responsável</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="visitasTableBody">
                                <tr>
                                    <td colspan="7" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB DASHBOARD -->
        <div id="tab-dashboard" class="tab-content">
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-line"></i> Resumo do Dia</h3>
                    <p><strong id="dashTotalVisitantes">0</strong> visitantes presenciais</p>
                    <p><strong id="dashVisitantesConcluidos">0</strong> visitas concluídas</p>
                    <p><strong id="dashVisitantesEmAndamento">0</strong> visitas em andamento</p>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-exclamation-triangle"></i> Pendências</h3>
                    <p><strong id="dashVisitantesPendentes">0</strong> visitantes aguardando</p>
                    <p><strong id="dashVisitantesAtrasados">0</strong> visitantes em espera prolongada</p>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-pie"></i> Estatísticas</h3>
                    <p><strong id="dashAreaMaisVisitada">-</strong> área mais visitada</p>
                    <p><strong id="dashTipoMaisComum">-</strong> tipo mais comum</p>
                </div>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-chart-bar"></i> Distribuição por Área</h3>
                <div class="chart-container">
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-bar"></i>
                        <p>Gráfico mostrando distribuição de visitas por área</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-chart-area"></i> Evolução Diária</h3>
                <div class="chart-container">
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-line"></i>
                        <p>Gráfico mostrando evolução diária de visitas</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Objeto principal do sistema
        const sistema = {
            config: {
                sheetsURL: localStorage.getItem('sheetsURL') || '',
                dadosLocais: JSON.parse(localStorage.getItem('dadosVisitas')) || []
            },
            dadosVisitas: [],
            
            // Inicialização
            init: function() {
                // Carrega a configuração
                if (this.config.sheetsURL) {
                    document.getElementById('sheetsURL').value = this.config.sheetsURL;
                    this.testarConexao();
                }
                
                // Evento do formulário
                document.getElementById('visitForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.adicionarVisita();
                });
                
                // Carrega dados iniciais
                this.atualizarVisitas();
                this.atualizarDashboard();
                
                // Atualiza status de sincronização
                this.atualizarStatusSync();
            },
            
            // Troca de abas
            trocarTab: function(tabId) {
                // Esconde todas as abas
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Mostra a aba selecionada
                document.getElementById(`tab-${tabId}`).classList.add('active');
                
                // Atualiza os botões das abas
                document.querySelectorAll('.tab').forEach(tabBtn => {
                    tabBtn.classList.remove('active');
                });
                event.currentTarget.classList.add('active');
                
                // Se for a aba dashboard, atualiza
                if (tabId === 'dashboard') {
                    this.atualizarDashboard();
                }
            },
            
            // Salva a URL do Google Sheets
            salvarConfig: function() {
                const url = document.getElementById('sheetsURL').value;
                if (url) {
                    localStorage.setItem('sheetsURL', url);
                    this.config.sheetsURL = url;
                    this.mostrarNotificacao('Configurações salvas!', 'success');
                } else {
                    this.mostrarNotificacao('Por favor, insira a URL.', 'error');
                }
            },
            
            // Testa a conexão com o Google Sheets
            testarConexao: async function() {
                if (!this.config.sheetsURL) {
                    this.mostrarNotificacao('URL não configurada.', 'error');
                    return;
                }
                
                try {
                    // Simulação de teste de conexão
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Em um sistema real, aqui seria uma chamada fetch para o Google Apps Script
                    document.getElementById('connectionStatus').className = 'status-connection status-online';
                    document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle"></i> Conectado';
                    this.mostrarNotificacao('Conexão bem-sucedida!', 'success');
                } catch (error) {
                    document.getElementById('connectionStatus').className = 'status-connection status-offline';
                    document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle"></i> Desconectado';
                    this.mostrarNotificacao(`Erro: ${error.message}`, 'error');
                }
            },
            
            // Adiciona uma nova visita
            adicionarVisita: function() {
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registrando...';
                
                const visita = {
                    id: Date.now(),
                    nome: document.getElementById('nomeVisitante').value,
                    empresa: document.getElementById('empresaOrigem').value,
                    tipo: document.getElementById('tipoVisitante').value,
                    telefone: document.getElementById('telefone').value,
                    area: document.getElementById('areaProcurada').value,
                    responsavel: document.getElementById('responsavel').value,
                    motivo: document.getElementById('motivoVisita').value,
                    entrada: new Date().toLocaleString('pt-BR'),
                    status: 'Aguardando'
                };
                
                // Simulação de salvamento
                setTimeout(() => {
                    // Adiciona aos dados locais
                    this.config.dadosLocais.push(visita);
                    localStorage.setItem('dadosVisitas', JSON.stringify(this.config.dadosLocais));
                    
                    // Atualiza a tabela
                    this.atualizarVisitas();
                    
                    // Limpa o formulário
                    document.getElementById('visitForm').reset();
                    
                    // Feedback para o usuário
                    this.mostrarNotificacao('Visita registrada com sucesso!', 'success');
                    
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> Registrar Entrada';
                }, 1500);
            },
            
            // Atualiza a lista de visitas
            atualizarVisitas: function() {
                // Simulação de carregamento
                const tbody = document.getElementById('visitasTableBody');
                tbody.innerHTML = '<tr><td colspan="7" class="loading"><div class="loading-spinner"></div></td></tr>';
                
                setTimeout(() => {
                    // Ordena por data mais recente
                    const dados = [...this.config.dadosLocais].sort((a, b) => b.id - a.id);
                    
                    // Atualiza estatísticas
                    this.atualizarEstatisticas(dados);
                    
                    // Renderiza a tabela
                    this.exibirVisitas(dados);
                }, 800);
            },
            
            // Exibe as visitas na tabela
            exibirVisitas: function(visitas) {
                const tbody = document.getElementById('visitasTableBody');
                tbody.innerHTML = '';
                
                if (visitas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">Nenhuma visita registrada ainda</td></tr>';
                    return;
                }
                
                visitas.forEach(visita => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${visita.entrada}</td>
                        <td>${visita.nome}</td>
                        <td>${visita.tipo}</td>
                        <td>${visita.area}</td>
                        <td>${visita.responsavel}</td>
                        <td><span class="status status-${visita.status.toLowerCase().replace(' ', '')}">${visita.status}</span></td>
                        <td class="actions">
                            ${visita.status === 'Aguardando' ? 
                                `<button class="btn btn-small btn-success" onclick="sistema.alterarStatusVisita(${visita.id}, 'Em Atendimento')"><i class="fas fa-play"></i> Iniciar</button>` : ''}
                            ${visita.status === 'Em Atendimento' ? 
                                `<button class="btn btn-small" onclick="sistema.alterarStatusVisita(${visita.id}, 'Concluído')"><i class="fas fa-check"></i> Finalizar</button>` : ''}
                            <button class="btn btn-small btn-danger" onclick="sistema.excluirVisita(${visita.id})"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            },
            
            // Atualiza as estatísticas na parte superior
            atualizarEstatisticas: function(visitas) {
                const hoje = new Date().toLocaleDateString('pt-BR');
                const visitasHoje = visitas.filter(v => v.entrada.includes(hoje));
                
                document.getElementById('totalHoje').textContent = visitasHoje.length;
                document.getElementById('aguardando').textContent = visitasHoje.filter(v => v.status === 'Aguardando').length;
                document.getElementById('emAtendimento').textContent = visitasHoje.filter(v => v.status === 'Em Atendimento').length;
                document.getElementById('concluidos').textContent = visitasHoje.filter(v => v.status === 'Concluído').length;
            },
            
            // Altera o status de uma visita
            alterarStatusVisita: function(id, novoStatus) {
                const visita = this.config.dadosLocais.find(v => v.id === id);
                if (visita) {
                    visita.status = novoStatus;
                    localStorage.setItem('dadosVisitas', JSON.stringify(this.config.dadosLocais));
                    this.atualizarVisitas();
                    this.mostrarNotificacao(`Status atualizado para ${novoStatus}`, 'success');
                }
            },
            
            // Exclui uma visita
            excluirVisita: function(id) {
                if (!confirm('Tem certeza que deseja excluir esta visita?')) return;
                
                this.config.dadosLocais = this.config.dadosLocais.filter(v => v.id !== id);
                localStorage.setItem('dadosVisitas', JSON.stringify(this.config.dadosLocais));
                this.atualizarVisitas();
                this.mostrarNotificacao('Visita excluída!', 'success');
            },
            
            // Filtra as visitas
            filtrarVisitas: function() {
                const tipo = document.getElementById('filtroTipo').value;
                const area = document.getElementById('filtroArea').value;
                const status = document.getElementById('filtroStatus').value;
                
                let dados = [...this.config.dadosLocais];
                
                if (tipo) dados = dados.filter(v => v.tipo === tipo);
                if (area) dados = dados.filter(v => v.area === area);
                if (status) dados = dados.filter(v => v.status === status);
                
                this.exibirVisitas(dados);
            },
            
            // Atualiza o dashboard
            atualizarDashboard: function() {
                const dados = this.config.dadosLocais;
                const hoje = new Date().toLocaleDateString('pt-BR');
                const visitasHoje = dados.filter(v => v.entrada.includes(hoje));
                
                document.getElementById('dashTotalVisitantes').textContent = visitasHoje.length;
                document.getElementById('dashVisitantesConcluidos').textContent = visitasHoje.filter(v => v.status === 'Concluído').length;
                document.getElementById('dashVisitantesEmAndamento').textContent = visitasHoje.filter(v => v.status === 'Em Atendimento').length;
                document.getElementById('dashVisitantesPendentes').textContent = visitasHoje.filter(v => v.status === 'Aguardando').length;
                document.getElementById('dashVisitantesAtrasados').textContent = visitasHoje.filter(v => v.status === 'Aguardando').length > 5 ? 3 : 0;
                
                // Área mais visitada
                if (visitasHoje.length > 0) {
                    const areas = visitasHoje.map(v => v.area);
                    const areaMaisFrequente = [...new Set(areas)]
                        .map(area => [area, areas.filter(a => a === area).length])
                        .sort((a, b) => b[1] - a[1])[0][0];
                    
                    document.getElementById('dashAreaMaisVisitada').textContent = areaMaisFrequente;
                    
                    // Tipo mais comum
                    const tipos = visitasHoje.map(v => v.tipo);
                    const tipoMaisFrequente = [...new Set(tipos)]
                        .map(tipo => [tipo, tipos.filter(t => t === tipo).length])
                        .sort((a, b) => b[1] - a[1])[0][0];
                    
                    document.getElementById('dashTipoMaisComum').textContent = tipoMaisFrequente;
                }
            },
            
            // Migra dados locais para o servidor
            migrarDadosLocais: function() {
                if (this.config.dadosLocais.length === 0) {
                    this.mostrarNotificacao('Nenhum dado local para migrar.', 'info');
                    return;
                }
                
                // Simulação de migração
                this.mostrarNotificacao(`Migrando ${this.config.dadosLocais.length} registros...`, 'success');
                
                setTimeout(() => {
                    // Aqui seria a chamada para o Google Sheets
                    this.config.dadosLocais = [];
                    localStorage.removeItem('dadosVisitas');
                    this.atualizarVisitas();
                    this.mostrarNotificacao('Migração concluída com sucesso!', 'success');
                }, 2000);
            },
            
            // Sincroniza dados
            sincronizarDados: function() {
                this.mostrarNotificacao('Sincronizando dados com o Google Sheets...', 'success');
                
                setTimeout(() => {
                    document.getElementById('lastSync').textContent = new Date().toLocaleString('pt-BR');
                    document.getElementById('totalRecords').textContent = this.config.dadosLocais.length;
                    this.mostrarNotificacao('Sincronização concluída!', 'success');
                }, 1500);
            },
            
            // Atualiza status de sincronização
            atualizarStatusSync: function() {
                document.getElementById('totalRecords').textContent = this.config.dadosLocais.length;
                
                const lastSync = localStorage.getItem('lastSync');
                document.getElementById('lastSync').textContent = lastSync || 'Nunca';
            },
            
            // Exporta para Excel
            exportarExcel: function() {
                // Simulação de exportação
                this.mostrarNotificacao('Preparando arquivo Excel para download...', 'success');
                
                setTimeout(() => {
                    this.mostrarNotificacao('Arquivo Excel pronto para download!', 'success');
                }, 1000);
            },
            
            // Exporta para PDF
            exportarPDF: function() {
                // Simulação de exportação
                this.mostrarNotificacao('Gerando relatório em PDF...', 'success');
                
                setTimeout(() => {
                    this.mostrarNotificacao('PDF gerado com sucesso!', 'success');
                }, 1000);
            },
            
            // Mostra notificações
            mostrarNotificacao: function(mensagem, tipo = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = mensagem;
                notification.className = 'notification';
                
                if (tipo === 'error') {
                    notification.classList.add('error');
                }
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        };

        // Inicia o sistema quando a página carregar
        window.addEventListener('DOMContentLoaded', () => {
            sistema.init();
            
            // Carrega dados de exemplo
            setTimeout(() => {
                if (sistema.config.dadosLocais.length === 0) {
                    sistema.config.dadosLocais = [
                        {
                            id: 1,
                            nome: "Carlos Silva",
                            empresa: "Tech Solutions",
                            tipo: "Fornecedor",
                            telefone: "(11) 98765-4321",
                            area: "TI/Tecnologia",
                            responsavel: "Ana Paula",
                            motivo: "Reunião sobre servidores",
                            entrada: new Date().toLocaleString('pt-BR'),
                            status: "Aguardando"
                        },
                        {
                            id: 2,
                            nome: "Mariana Oliveira",
                            empresa: "Global Corp",
                            tipo: "Cliente",
                            telefone: "(11) 91234-5678",
                            area: "Vendas/Comercial",
                            responsavel: "Roberto Santos",
                            motivo: "Negociação de contrato",
                            entrada: new Date().toLocaleString('pt-BR'),
                            status: "Em Atendimento"
                        },
                        {
                            id: 3,
                            nome: "Ricardo Fernandes",
                            empresa: "InovaTech",
                            tipo: "Parceiro",
                            telefone: "(11) 99876-5432",
                            area: "Marketing",
                            responsavel: "Juliana Costa",
                            motivo: "Planejamento campanha",
                            entrada: new Date().toLocaleString('pt-BR'),
                            status: "Concluído"
                        }
                    ];
                    localStorage.setItem('dadosVisitas', JSON.stringify(sistema.config.dadosLocais));
                    sistema.atualizarVisitas();
                }
            }, 2000);
        });
    </script>
</body>
</html>
